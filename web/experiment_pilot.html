<!doctype html>
<html>
<head>
    <title>Pilots</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="util/group_theory.js"></script>
    <script src="util/etc.js"></script>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/jspsych-instructions.js"></script>
    <script src="jspsych/plugins/jspsych-survey-text.js"></script>
    <script src="jspsych/plugins/fractal-mutation-plugin.js"></script>
    <script src="jspsych/plugins/two-door-navigation-plugin.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
</body>
    <script>
    var first_dihedral = true; // will first task be dihedral group? (otherwise dicyclic)
    var isomorphic = true; // will two tasks be isomorphic?

    if (first_dihedral) {
        var this_group_a = new dihedral_group(6);
        if (isomorphic) {
            var this_group_b = new dihedral_group(6);
        } else {
            var this_group_b = new dicyclic_group_12();
        }
    } else {
        var this_group_a = new dicyclic_group_12;
        if (isomorphic) {
            var this_group_b = new dicyclic_group_12();
        } else {
            var this_group_b = new dihedral_group(6);
        }
    }

    var this_fractal_assignment = ['images/blu_wht.png', 'images/cyn_red.png', 'images/grn_blu.png', 'images/grn_prp.png', 'images/grn_red.png', 'images/gry_blk.png', 'images/org_blu.png', 'images/pnk_blu.png', 'images/red_prp.png', 'images/wht_red.png', 'images/ylw_pnk.png', 'images/ylw_slt.png'];
    shuffle(this_fractal_assignment);
    jsPsych.pluginAPI.preloadImages(this_fractal_assignment, function() {start_experiment();});
        
    var this_mutagen_assignment = [1, 0];
    shuffle(this_mutagen_assignment);
    var this_room_assignment = ["red", "green", "blue", "grey", "ivory", "orange", "pink", "brown", "yellow", "purple", "cyan", "olive"];
    shuffle(this_room_assignment);
    var this_door_generator_assignment = [1, 0];
    shuffle(this_door_generator_assignment);
    var this_door_color_assignment = ["white", "black"];
    shuffle(this_door_color_assignment);

    var block_timeline = [
        {goal: 2, start: 0},
        {goal: 6, start: 2},
        {goal: 9, start: 6},
        {goal: 1, start: 9},
        {goal: 7, start: 1}
//,
//        {goal: 11, start: 7},
//        {goal: 8, start: 11},
//        {goal: 5, start: 8},
//        {goal: 10, start: 5},
//        {goal: 4, start: 10},
//        {goal: 3, start: 4}
    ]

    var fractal_instructions = {
	type: 'instructions',
        show_clickable_nav: true,
	pages: [
            'Welcome to our experiment. This experiment investigates learning of relationships between visual patterns. If you do not wish to participate in this experiment, please return this HIT now.',
            "In this experiment, you are a scientist. This is a very exciting time, because astronauts have just discovered alien life on Saturn\'s moon Enceladus. These creatures form strange fractal colonies in a petri dish. It was accidentally noticed that pouring sulfuric acid onto the creatures or zapping them with gamma rays will cause them to mutate into one of the other fractals. Your job is to help figure out the relationships between these different fractals, by using acid (by pressing 'a' on your keyboard) or gamma rays (by pressing 'g') to make a certain fractal."
	]
    }

    var fractal_trials = {
        type: 'fractal-mutation',
        group: this_group_a,
        fractal_assignment: this_fractal_assignment,
        mutagen_generator_assignment: this_mutagen_assignment,
        timeline: block_timeline 
    };

    var room_instructions = {
	type: 'instructions',
        show_clickable_nav: true,
	pages: [
            'Welcome to our experiment. This experiment investigates spatial navigation abilities. If you do not wish to participate in this experiment, please return this HIT now.',
            'In this experiment, you are exploring a haunted house. Your goal is to find your way between rooms by figuring out the layout of the house. Each room will have a ' + this_door_color_assignment[0] + ' door on the left and a ' + this_door_color_assignment[1] + ' door on the right, click on a door to go throuh it. BEWARE: because the house is haunted, the dark passages between the rooms may not always take you to the same place...'
	]
    }

    var room_trials = {
        type: 'two-door-navigation',
        group: this_group_b,
        room_assignment: this_room_assignment,
        door_color_assignment: this_door_color_assignment,
        door_generator_assignment: this_door_generator_assignment,
        timeline: block_timeline 
    };

    var debrief = {
	type: 'survey-text',
	questions: ['What is your name? (For debugging purposes, will not be in the actual experiment.)', 'Did you notice anything weird about the experiment?']
    }

    function saveData(filename, filedata){
       $.ajax({
	  type:'post',
	  cache: false,
	  url: 'http://web.stanford.edu/~lampinen/cgi-bin/save_data.php', 
	  data: {filename: filename, filedata: filedata}
       });
    }

    var start_experiment = function() {
        jsPsych.init({
            timeline: [room_instructions, room_trials, debrief, fractal_instructions, fractal_trials, debrief],
            on_finish: function() {
		var d = new Date();
		saveData("il_pilot/pilot" + d.getTime() + ".json", jsPsych.data.dataAsJSON());
//                jsPsych.data.displayData('json');
            }
        })
    };
    </script>
</html>
