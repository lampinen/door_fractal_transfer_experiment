<!doctype html>
<html>
<head>
    <title>Experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="util/group_theory.js"></script>
    <script src="util/etc.js"></script>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/fractal-mutation-plugin.js"></script>
    <script src="jspsych/plugins/two-door-navigation-plugin.js"></script>
    <script src="jspsych/plugins/drag-drop-on-image-plugin.js"></script>
    <script src="jspsych/plugins/jspsych-survey-multi-choice.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="css/other.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
</body>
    <script>
    function choice(a) {
        return a[Math.floor(Math.random() * a.length)];
    }

    let this_group =  new hexagon_tri();
    var elements = this_group.get_elements();

    var this_fractal_assignment = ['images/blu_wht.png', 'images/cyn_red.png', 'images/gry_blk.png', 'images/org_blu.png', 'images/pnk_blu.png', 'images/ylw_slt.png'];
    jsPsych.pluginAPI.preloadImages(this_fractal_assignment, function() {start_experiment();});
        
    var this_mutagen_assignment = [1, 0];
    var this_room_assignment = ["red", "green", "blue", "grey", "yellow", "purple"];
    var this_door_generator_assignment = [1, 0];
    var this_door_color_assignment = ["white", "black"];

    var test_fractal = {
        type: 'fractal-mutation',
        group: this_group,
        fractal_assignment: this_fractal_assignment,
        mutagen_generator_assignment: this_mutagen_assignment,
        action_noise: 0,
        goal: 4,
        start: 0
    };

    var test_fractal_2 = {
        type: 'fractal-mutation',
        group: this_group,
        fractal_assignment: this_fractal_assignment,
        mutagen_generator_assignment: this_mutagen_assignment,
        action_noise: 0,
        goal: 1,
        start: 3
    };

    var test_room = {
        type: 'two-door-navigation',
        group: this_group,
        room_assignment: this_room_assignment,
        door_color_assignment: this_door_color_assignment,
        door_generator_assignment: this_door_generator_assignment,
        action_noise: 0,
        goal: 4,
        start: 0
    };
    var test_room_2 = {
        type: 'two-door-navigation',
        group: this_group,
        room_assignment: this_room_assignment,
        door_color_assignment: this_door_color_assignment,
        door_generator_assignment: this_door_generator_assignment,
        action_noise: 0,
        goal: 1,
        start: 3
    };

    var dragging_images = this_fractal_assignment.slice(); 
    shuffle(dragging_images);
    var drag_test = {
	type: 'drag-drop-on-image',
	background_image: "images/diagrams/hexagon_bi.png",
	dragging_images: dragging_images,
	target_locations: [{"x": 341, "y": 0}, {"x": 500, "y": 84},
            {"x": 500, "y": 237}, {"x": 341, "y": 320},
            {"x": 180, "y": 237}, {"x": 180, "y": 84}],
	location_labels: [0, 1],
        preplaced_image: this_fractal_assignment[0],
        preplaced_image_location: 0, // This is the ``0'' location in the group_theory.js representation 
        instruction_text:"The fractal relationships in your experiment obeyed the structure above (black squares = fractals, red arrows = acid, blue arrows = gamma ray). Drag the fractals onto the black squares that you think they map onto (one has been placed to get you started)." 
    }

    var diagram_selection = {
	type: 'survey-multi-choice',
	questions: [ "The fractal relationships in your experiment obeyed one of the structures below, where the black squares correspond to fractals, the red arrows correspond to either the gamma ray or the acid, and the blue arrows correspond to the other. Select the structure that you think you had."],
	 options: [["<img src='images/diagrams/hexagon_bi.png'>", "<img src='images/diagrams/hexagon_tri.png'>"]],
    }

    var correspondence_options = ["white door = acid, black door = ray", "black door = acid, white door = ray"];
    shuffle(correspondence_options);
    var room_fractal_correspondence_examples = "<table class='correspondence-table'><tr><td><img src='images/room_snapshots/"+ this_room_assignment[0] + "_room_" + this_door_color_assignment[0] + "_left.png' /></td><td><img src='images/room_snapshots/"+ this_room_assignment[1] + "_room_" + this_door_color_assignment[0] + "_left.png' /></td><td><img src='images/room_snapshots/"+ this_room_assignment[2] + "_room_" + this_door_color_assignment[0] + "_left.png' /></td><td><img src='images/room_snapshots/"+ this_room_assignment[3] + "_room_" + this_door_color_assignment[0] + "_left.png' /></td></tr><tr><td><img src='"+ this_fractal_assignment[0] + "' /></td><td><img src='" + this_fractal_assignment[1] + "' /></td><td><img src='" + this_fractal_assignment[2] + "' /></td><td><img src='" + this_fractal_assignment[3] + "' /></td></tr></table>";

    var correspondence_identification = {type: "survey-multi-choice", questions: ["Assuming the experiments were teaching you the same structure, each room in the navigation experiment corresponded to a particular fractal in the visual pattern experiment, and one of the doors in the spatial navigation experiment corresponded to the gamma ray in the fractal experiment, and the other door corresponded to the acid. Below is a table showing you which fractals a few rooms corresponded to:<br />" + room_fractal_correspondence_examples + "<br />What is your best guess about what the correspondence between the doors and the gamma ray and acid was?", "How confident are you in your guess?"], options: [correspondence_options, ["Not at all confident", "Slightly confident", "Moderately confident", "Pretty confident", "Completely confident"]]} 

    var start_experiment = function() {
        jsPsych.init({
            timeline: [test_room, test_room_2, test_fractal, test_fractal_2, diagram_selection, drag_test, correspondence_identification],
            on_finish: function() {
                jsPsych.data.displayData('json');
            }
        })
    };
    </script>
</html>
