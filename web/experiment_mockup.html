<!doctype html>
<html>
<head>
    <title>Experiment</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="util/group_theory.js"></script>
    <script src="util/etc.js"></script>
    <script src="jspsych/jspsych.js"></script>
    <script src="jspsych/plugins/fractal-mutation-plugin.js"></script>
    <script src="jspsych/plugins/two-door-navigation-plugin.js"></script>
    <script src="jspsych/plugins/card-game-plugin.js"></script>
    <script src="jspsych/plugins/drag-drop-on-image-plugin.js"></script>
    <script src="jspsych/plugins/drag-drop-clustering-plugin.js"></script>
    <script src="jspsych/plugins/jspsych-survey-multi-choice.js"></script>
    <link href="jspsych/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <link href="css/other.css" rel="stylesheet" type="text/css"></link>
</head>
<body>
</body>
    <script>
    function choice(a) {
        return a[Math.floor(Math.random() * a.length)];
    }

    let this_group =  new hexagon_tri();
    var elements = this_group.get_elements();

    var this_fractal_assignment = ['images/blu_wht.png', 'images/cyn_red.png', 'images/gry_blk.png', 'images/org_blu.png', 'images/pnk_blu.png', 'images/ylw_slt.png'];
        
    var this_mutagen_assignment = [1, 0];
    var this_room_assignment = ["red", "green", "blue", "grey", "yellow", "purple"];
    var this_door_generator_assignment = [1, 0];
    var this_door_color_assignment = ["white", "black"];

    var this_card_assignment = ['triangle', 'circle', 'square', 'diamond', 'moon', 'lightning', 'squiggle', 'plus'];
    var this_pattern_assignment = [1, 0]; 

    var test_card = {
        type: 'card-game',
        group: this_group,
        card_assignment: this_card_assignment,
        pattern_generator_assignment: this_pattern_assignment,
        action_noise: 0,
        goal: 4,
        start: 0
    };

    var test_card_2 = {
        type: 'card-game',
        group: this_group,
        card_assignment: this_card_assignment,
        pattern_generator_assignment: this_pattern_assignment,
        action_noise: 0,
        goal: 1,
        start: 4
    };

    var test_fractal = {
        type: 'fractal-mutation',
        group: this_group,
        fractal_assignment: this_fractal_assignment,
        mutagen_generator_assignment: this_mutagen_assignment,
        action_noise: 0,
        goal: 4,
        start: 0
    };

    var test_fractal_2 = {
        type: 'fractal-mutation',
        group: this_group,
        fractal_assignment: this_fractal_assignment,
        mutagen_generator_assignment: this_mutagen_assignment,
        action_noise: 0,
        goal: 1,
        start: 4
    };

    var test_room = {
        type: 'two-door-navigation',
        group: this_group,
        room_assignment: this_room_assignment,
        door_color_assignment: this_door_color_assignment,
        door_generator_assignment: this_door_generator_assignment,
        action_noise: 0,
        goal: 4,
        start: 0
    };
    var test_room_2 = {
        type: 'two-door-navigation',
        group: this_group,
        room_assignment: this_room_assignment,
        door_color_assignment: this_door_color_assignment,
        door_generator_assignment: this_door_generator_assignment,
        action_noise: 0,
        goal: 1,
        start: 4
    };

    var dragging_images = this_fractal_assignment.slice(); 
    shuffle(dragging_images);
    var drag_test = {
	type: 'drag-drop-on-image',
	background_image: "images/diagrams/hexagon_bi.png",
	dragging_images: dragging_images,
	target_locations: [{"x": 341, "y": 0}, {"x": 500, "y": 84},
            {"x": 500, "y": 237}, {"x": 341, "y": 320},
            {"x": 180, "y": 237}, {"x": 180, "y": 84}],
	location_labels: [0, 1],
        preplaced_image: this_fractal_assignment[0],
        preplaced_image_location: 0, // This is the ``0'' location in the group_theory.js representation 
        instruction_text:"The fractal relationships in your experiment obeyed the structure above (black squares = fractals, red arrows = acid, blue arrows = gamma ray). Drag the fractals onto the black squares that you think they map onto (one has been placed to get you started)." 
    }

    var dragging_images_2 = this_fractal_assignment.slice(); 
    shuffle(dragging_images_2);
    var drag_corr_room_images = ["images/room_snapshots/"+ this_room_assignment[0] + "_room_" + this_door_color_assignment[0] + "_left.png",
                                 "images/room_snapshots/"+ this_room_assignment[1] + "_room_" + this_door_color_assignment[0] + "_left.png",
                                 "images/room_snapshots/"+ this_room_assignment[2] + "_room_" + this_door_color_assignment[0] + "_left.png",
                                 "images/room_snapshots/"+ this_room_assignment[3] + "_room_" + this_door_color_assignment[0] + "_left.png",
                                 "images/room_snapshots/"+ this_room_assignment[4] + "_room_" + this_door_color_assignment[0] + "_left.png",
                                 "images/room_snapshots/"+ this_room_assignment[5] + "_room_" + this_door_color_assignment[0] + "_left.png"]
    var drag_corr_room_order = range(drag_corr_room_images.length);
    shuffle(drag_corr_room_order);
    drag_corr_room_images = permute(drag_corr_room_images, drag_corr_room_order);

    var drag_corr_test = { //TODO: fix paths, names
	type: 'drag-drop-on-image',
        background_images: drag_corr_room_images,
        background_image_locations: [{"x": 0, "y": 300}, {"x": 100, "y": 300}, 
            {"x": 200, "y": 300}, {"x": 300, "y": 300}, 
            {"x": 400, "y": 300}, {"x": 500, "y": 300}],
        bg_image_height: 67,
        bg_image_width: 100,
	dragging_images: dragging_images_2,
        target_locations: [{"x": 10, "y": 300}, {"x": 110, "y": 300}, 
            {"x": 210, "y": 300}, {"x": 310, "y": 300}, 
            {"x": 410, "y": 300}, {"x": 510, "y": 300}],
	location_labels: [0, 1],
        snap_padding: 10,
        background_order: drag_corr_room_order,
        instruction_text:"Assuming the experiments were teaching you the same structure, each room in the navigation experiment corresponded to a fractal in the visual patterns experiment. Drag the fractals onto the rooms you think they corresponded to." 
    }

    var drag_clust_test = { //TODO: fix paths, names
	type: 'drag-drop-clustering',
	dragging_images: dragging_images_2,
	location_labels: [0, 1],
        snap_padding: 10,
        background_order: drag_corr_room_order,
        instruction_text:"Place the different fractals onto the grey part of the display in two or more groups that reflect how you thought about them as you were performing the task." 
    }

    var diagram_selection = {
	type: 'survey-multi-choice',
	questions: [ "The fractal relationships in your experiment obeyed one of the structures below, where the black squares correspond to fractals, the red arrows correspond to either the gamma ray or the acid, and the blue arrows correspond to the other. Select the structure that you think you had."],
	 options: [["<img src='images/diagrams/hexagon_bi.png'>", "<img src='images/diagrams/hexagon_tri.png'>"]],
    }

    var correspondence_options = ["white door = acid, black door = ray", "black door = acid, white door = ray"];
    shuffle(correspondence_options);

    var correspondence_identification = {type: "survey-multi-choice", questions: ["Assuming the experiments were teaching you the same structure, one of the doors in the spatial navigation experiment corresponded to the gamma ray in the fractal experiment, and the other door corresponded to the acid. What is your best guess about what the correspondence between the doors and the gamma ray and acid was?", "How confident are you in your guess?"], options: [correspondence_options, ["Not at all confident", "Slightly confident", "Moderately confident", "Pretty confident", "Completely confident"]]} 

    var correspondence_suspect = {type: "survey-multi-choice", questions: ["Did you suspect there was a correspondence between the relationships learned in the spatial learning experiment and the relationships learned in the visual patterns experiment?"], options: [["Yes", "No"]]}

    var start_experiment = function() {
        jsPsych.init({
            timeline: [drag_clust_test, test_card, test_card_2, test_room, test_room_2, test_fractal, test_fractal_2, correspondence_suspect, drag_test, drag_corr_test, correspondence_identification],
            on_finish: function() {
                jsPsych.data.displayData('json');
            }
        })
    };
    
    $.getJSON("../web/distributions/hexagon_bi.json", function(hb_result) { // TODO: don't forget to change url

            //TODO: update and expand
            if (this_group.get_name() == "hexagon_bi") {
                this_group.distributions = hb_result;
            }
            
            $.getJSON("distributions/hexagon_tri.json", function(ht_result) {// TODO: don't forget to change url
                    //TODO: update and expand
                    if (this_group.get_name() == "hexagon_tri") {
                        this_group.distributions = ht_result;
                    }
                
                    jsPsych.pluginAPI.preloadImages(this_fractal_assignment, function() {start_experiment();});
                });
        });
    
    </script>
</html>
